# V4: 認証とセッション管理要件

## 管理目標

多くの場合、リモートサービスへのユーザーログインはモバイルアプリアーキテクチャ全体の不可欠な要素です。ロジックの大半はエンドポイントで発生しますが、MASVSではユーザーアカウントとセッションの管理方法に関するいくつかの基本的な要件を定義します。サービスエンドポイントのソースコードにアクセスせずに簡単に要件を検証できます。

## セキュリティ検証要件

| # | 説明 | L1 | L2 |
| --- | --- | --- | --- | --- |
| **4.1** | アプリがリモートサービスへのアクセスを提供する場合、ユーザー名/パスワード認証など許容される形態の認証がリモートエンドポイントで実行されている。 | ✓ | ✓ |
| **4.2** | リモートエンドポイントはランダムに生成されたアクセストークンを使用し、ユーザーの資格情報を送信せずにクライアント要求を認証している。 | ✓ | ✓ |
| **4.3** | ユーザーがログアウトする場合に、リモートエンドポイントは既存のセッションを終了している。 | ✓ | ✓ |
| **4.4** | パスワードポリシーが存在し、リモートエンドポイントで実施されている。 | ✓ | ✓ |
| **4.5** | 不正な認証資格情報が過度に送信される場合、リモートエンドポイントはExponential Backoffを実装しているか一時的にユーザーアカウントをロックしている。 | ✓ | ✓ |
| **4.6** | 生体認証が使用される場合は（単に「true」や「false」を返すAPIを使うなどの）イベントバインディングは使用しない。代わりに、キーチェーンやキーストアのアンロックに基づくものとする。 |   | ✓ |
| **4.7** | 非アクティブな状態で所定の期間経過後、リモートエンドポイントでセッションを終了している。 |   | ✓ |
| **4.8** | リモートエンドポイントに二要素認証が存在し、リモートエンドポイントで二要素認証要件が一貫して適用されている。 |   | ✓ |
| **4.9** | 機密データやトランザクションを処理するアクションを有効にするには、ステップアップ認証が必要とされている。 |   | ✓ |
| **4.10** | アプリはユーザーのアカウントでのすべてのログインアクティビティをユーザーに通知している。ユーザーはアカウントへのアクセスに使用されるデバイスの一覧を表示し、特定のデバイスをブロックすることができる。 |  | ✓ |

## 参考情報

OWASP モバイルセキュリティテストガイドには、このセクションに記載されている要件を検証するための詳細な手順を提供しており、モバイルオペレーティングシステムによるベストプラクティスも同様に記されています。

(...TODO... link this to v1.0 instead of master once tagged).

- Android - https://github.com/OWASP/owasp-mstg/blob/master/Document/Testcases/0x01c_OMTG-AUTH_Android.md
- iOS - https://github.com/OWASP/owasp-mstg/blob/master/Document/Testcases/0x02c_OMTG-AUTH_iOS.md

詳しくは以下の情報を参照してください。

- OWASP Mobile Top 10: M4 - 安全でない認証, M6 - 安全でない認可
- CWE:  https://cwe.mitre.org/data/definitions/287.html

## 参考情報（日本語）

- CWE:  http://jvndb.jvn.jp/ja/cwe/CWE-287.html
