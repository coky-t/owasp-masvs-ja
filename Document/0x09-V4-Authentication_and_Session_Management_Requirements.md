# V4: 認証とセッション管理要件

## 管理目標

多くの場合、リモートサービスへのユーザーログインはモバイルアプリアーキテクチャ全体の不可欠な要素です。ロジックの大半はエンドポイントで発生しますが、MASVSではユーザーアカウントとセッションの管理方法に関するいくつかの基本的な要件を定義します。サービスエンドポイントのソースコードにアクセスせずに簡単に要件を検証できます。

トークンベースの認証へのモバイルアプリの移行をカバーするために、要件はステートフル (クラシカルなセッション管理) とステートレス認証メカニズムの双方をカバーします。

## セキュリティ検証要件

| # | 説明 | L1 | L2 |
| --- | --- | --- | --- |
| **4.1** | アプリがリモートサービスへのアクセスを提供する場合、ユーザー名/パスワード認証など許容される形態の認証がリモートエンドポイントで実行されている。 | ✓ | ✓ |
| **4.2** | リモートエンドポイントはランダムに生成されたセッション識別子を使用し、クラシカルなサーバー側セッション管理が使用されている場合、ユーザーの資格情報を送信せずにクライアント要求を認証している。 | ✓ | ✓ |
| **4.3** | リモートエンドポイントはサーバー側の署名付きトークンを使用し、ステートレス認証が使用されている場合、ユーザーの資格情報を送信せずにクライアントリクエストを認証している。  | ✓ | ✓ |
| **4.4** | ユーザーがログアウトする場合に、リモートエンドポイントは既存のセッションやサーバー側の署名付きトークンを終了している。 | ✓ | ✓ |
| **4.5** | パスワードポリシーが存在し、リモートエンドポイントで実施されている。 | ✓ | ✓ |
| **4.6** | 不正な認証資格情報が過度に送信される場合、リモートエンドポイントはExponential Backoffを実装しているか一時的にユーザーアカウントをロックしている。 | ✓ | ✓ |
| **4.7** | 生体認証が使用される場合は（単に「true」や「false」を返すAPIを使うなどの）イベントバインディングは使用しない。代わりに、キーチェーンやキーストアのアンロックに基づくものとする。 |   | ✓ |
| **4.8** | 非アクティブな状態で所定の期間経過後、リモートエンドポイントでセッションやサーバー側の署名付きトークンを終了している。 |   | ✓ |
| **4.9** | リモートエンドポイントに二要素認証が存在し、リモートエンドポイントで二要素認証要件が一貫して適用されている。 |   | ✓ |
| **4.10** | 機密データやトランザクションを処理するアクションを有効にするには、ステップアップ認証が必要とされている。 |   | ✓ |
| **4.11** | アプリはユーザーのアカウントでのすべてのログインアクティビティをユーザーに通知している。ユーザーはアカウントへのアクセスに使用されるデバイスの一覧を表示し、特定のデバイスをブロックすることができる。 |  | ✓ |

## 参考情報

OWASP モバイルセキュリティテストガイドでは、このセクションに記載されている要件を検証するための詳細な手順を提供しています。

- Android 用 - https://github.com/OWASP/owasp-mstg/blob/master/Document/0x05f-Testing-Authentication.md
- iOS 用 - https://github.com/OWASP/owasp-mstg/blob/master/Document/0x06f-Testing-Authentication-and-Session-Management.md

詳しくは以下の情報を参照してください。

- OWASP Mobile Top 10: M4 - 安全でない認証, M6 - 安全でない認可
- CWE:  https://cwe.mitre.org/data/definitions/287.html

## 参考情報（日本語）

- CWE:  http://jvndb.jvn.jp/ja/cwe/CWE-287.html
