# V9: リバースエンジニアリングに対する耐性要件

## 管理目標

このセクションでは、機密データや機能を処理したりアクセスを与えたりするアプリに推奨される多層防御施策を取り扱います。これらのコントロールのいずれかが欠如しても脆弱性を引き起こすことはありません。代わりに、第三者がアプリの内部やアプリから抽出したデータを理解しようとすることを困難にし、リバースエンジニアリングに対する耐性を高めることを意図しています。

このセクションのコントロールは、一般的にすべてのモバイルアプリに適用されない点で前のセクションと異なります。むしろ、ここで説明したコントロールは、アプリケーションの不正改造やリバースエンジニアリングによるリスクアセスメントに基づいて、必要に応じて適用する必要があります。

OWASPドキュメント「リバース エンジニアリングや不正なコード変更の技術的リスク」（下記の参考情報を参照）には、ビジネスリスクと依存する技術的（改竄やリバースエンジニアリングに関連する）脅威が記載されています。以下のセクションでは、そのドキュメントで説明されている技術的な脅威を参照します。

以下のリストのコントロールのいずれかが有効であるためには、アプリは少なくともMASVS-L1のすべてとV8でのすべての低い番号の要求を満たしている必要があります。例えば、「理解の阻止」に記載されている難読化コントロールは「アプリの隔離」、「動的解析と改竄の阻止」、「デバイス結合」と組み合わせる必要があります。

**ソフトウェア保護はセキュリティコントロールの代わりに使用してはならないことに注意してください。MASVS-Rにリストされているコントロールは、MASVSセキュリティ要件を満たしているアプリに、脅威に特化した追加の保護コントロールを追加することを意図しています。**

以下の考慮事項が適用されます。

1. 攻撃者の目標を明確に示す脅威モデルを定義する必要があります。さらに、保護スキームが提供することになっている保護レベルを指定するターゲットを設定する必要があります（例えば、最先端のツールおよびプロセスを使用して、定義された目標 X に到達するためには、熟練したリバースエンジニアで少なくとも20人日の工数を要します）。

2. 保護スキームは対象分野の専門家によるマニュアルでの耐性テストを使用して検証する必要があります（モバイルセキュリティテストガイドの「リバースエンジニアリング」および「ソフトウェア保護の評価」の章も参照してください）。

### アプリの隔離

| # | 説明 | R |
| --- | --- | --- | --- |
| **8.1** | 機密データを入力する場面ではアプリはカスタムキーボードを提供している。 | ✓ |
| **8.2** | 機密データを表示するためにカスタムUIコンポーネントが使用されている。UIコンポーネントはイミュータブルなデータ構造に依存していない。 | ✓ |

### 動的解析と改竄の阻止

| # | 説明 | R |
| --- | --- | --- | --- |
| **8.3** | アプリは二つ以上の機能的に依存しないルート検出方式を実装しており、ユーザーに警告するかアプリを終了することでルート化デバイスの存在に応答している。 | ✓ |
| **8.4** | アプリは複数の機能的に依存しないデバッグ防御を実装している。全体的な保護スキームとの関連で、敵対者がデバッグを可能にするために多くの手間をかけなければならないように強制している。利用可能なすべてのデバッグプロトコル（JDWPやネイティブなど）を網羅している必要がある。 | ✓ |
| **8.5** | アプリは実行ファイルや重要なデータの改竄を検出し応答している。 | ✓ |
| **8.6** | アプリはコードインジェクションツール、フックフレームワーク、デバッグサーバーなどの広く使用されるリバースエンジニアリングツールの存在を検出している。 | ✓ |
| **8.7** | アプリは任意の方法を使用してエミュレータ内で動作しているかどうかを検出し応答している。 | ✓ |
| **8.8** | アプリは再配置テーブルパッチや注入コードを含むプロセスメモリの変更を検出し応答している。 | ✓ |
| **8.9** | アプリは改竄、デバッグ、エミュレーションに複数の異なる応答を実装している。単にアプリを終了しないステルス応答を含む。 | ✓ |
| **8.10** | アプリに属するすべての実行可能ファイルとライブラリは、ファイルレベルで暗号化されるか、もしくは実行ファイル内の重要なコードおよびデータセグメントが暗号化もしくはパック化されている。普通の静的解析では重要なコードやデータを明らかにできない。 | ✓ |
| **8.11** | 難読化変換および機能的防御が相互に依存し、アプリ全体で十分に統合されている。 | ✓ |

### デバイス結合

| # | 説明 | R |
| --- | --- | --- | --- |
| **8.12**| アプリはデバイスに固有の複数のプロパティから由来したデバイスフィンガープリントを使用して「デバイス結合」機能を実装している。 | ✓ |

### 理解の阻止

| # | 説明 | R |
| --- | --- | --- | --- |
| **8.13** | アプリは複数の機能的に異なるエミュレータ検出手段を使用している。全体的な保護スキームとの関連で、敵対者がエミュレータでアプリを実行するために多くの手間をかけなければならないよう強制している。（要件 9.7 に優先する） | ✓ |
| **8.14** | デバイスに機密情報を保存するアーキテクチャが必要である場合、アプリはハードウェアでサポートされるキーストレージを提供するオペレーティングシステムバージョンとデバイスでのみ実行されている。あるいは、情報は難読化を使用して保護されている。現在公表されている研究を考慮し、難読化タイプおよびパラメータは機密データを理解もしくは抽出しようとするリバースエンジニアに手作業で多くの努力を払う必要が十分にあること。 | ✓ |
| **8.15** | クライアント側で機密性の高い計算を実行するアーキテクチャが必要である場合、これらの計算はハードウェアベースのSEもしくはTEEを使用してオペレーティングシステムから分離している。あるいは、情報は難読化して保護されている。現在公表されている研究を考慮し、難読化タイプおよびパラメータはコードやデータの機密部分を理解しようとするリバースエンジニアに手作業で多くの努力を払う必要が十分にあること。 | ✓ |


## 参考情報

OWASP モバイルセキュリティテストガイドには、このセクションに記載されている要件を検証するための詳細な手順を提供しており、モバイルオペレーティングシステムによるベストプラクティスも同様に記されています。

(...TODO... link this to v1.0 instead of master once tagged).

- Android - https://github.com/OWASP/owasp-mstg/blob/master/Document/0x05j-Testing-Resiliency-Against-Reverse-Engineering.md
- iOS - https://github.com/OWASP/owasp-mstg/blob/master/Document/0x06j-Testing-Resiliency-Against-Reverse-Engineering.md

詳しくは以下の情報を参照してください。

- OWASP Mobile Top 10: M8 - コード改竄, M9 - リバースエンジニアリング
- OWASP Reverse Engineering Threats - https://www.owasp.org/index.php/Technical_Risks_of_Reverse_Engineering_and_Unauthorized_Code_Modification
- OWASP Reverse Engineering and Code Modification Prevention - https://www.owasp.org/index.php/OWASP_Reverse_Engineering_and_Code_Modification_Prevention_Project

## 参考情報（日本語）

- OWASP Reverse Engineering and Code Modification Prevention - https://www.owasp.org/index.php/%E3%83%AA%E3%83%90%E3%83%BC%E3%82%B9_%E3%82%A8%E3%83%B3%E3%82%B8%E3%83%8B%E3%82%A2%E3%83%AA%E3%83%B3%E3%82%B0%E3%82%84%E4%B8%8D%E6%AD%A3%E3%81%AA%E3%82%B3%E3%83%BC%E3%83%89%E5%A4%89%E6%9B%B4%E3%81%AE%E6%8A%80%E8%A1%93%E7%9A%84%E3%83%AA%E3%82%B9%E3%82%AF
